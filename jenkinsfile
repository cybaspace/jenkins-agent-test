agentName = "commerce-manifest-tool"
COMMERCE_VERSION = ''

pipeline {
    agent { label agentName }

    stages {
        stage('Prep') {
            steps {
                script {
                    COMMERCE_VERSION = sh (
                        script: 'sap-commerce-manifest-tool -latest version',
                        returnStdout: true
                    ).trim()
                    agentName = "commerce-agent-" + COMMERCE_VERSION
                    sh 'echo "Test" > test.txt'
                    sh 'ls -al'
                }
            }
        }
        stage('Checking') {
            steps {
                script {
                    println agentName
                    sh 'ls -al'
                }
            }
        }
        stage('Between') {
            agent { label agentName }

            steps {
                script {
                    println agentName
                    sh 'ls -al'
                }
            }
        }
        stage('Final') {
            agent { label agentName }

            steps {
                script {
                    println agentName
                    println COMMERCE_VERSION
                }
                echo "${COMMERCE_VERSION}"
            }
        }
    }
}
